<odoo>
  <template id="report_flat_hqi_pdf_template">
    <t t-set="doc" t-value="docs[0]" />
    <t t-call-assets="web.report_assets_common" t-js="false"/>
    <t t-set="company" t-value="env['res.company'].search([], limit=1)" />

    <main class="page" style="padding: 30px; font-family: Arial, sans-serif; font-size: 12px;">

      <!-- <h2 style="text-align:center; margin-bottom:20px;">Home Quality Inspection Report (Flat Summary)</h2> -->
      <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
        <tr>
          <td style="width: 30%; vertical-align: middle;">
            <t t-if="doc.project_id.image">
              <img t-att-src="'data:image/png;base64,%s' % doc.project_id.image.decode('utf-8')" style="max-height: 80px;" />
            </t>
          </td>
          <td style="width: 40%; text-align: center; vertical-align: middle;">
            <h2 style="margin: 0; font-size: 18px;">Home Quality Inspection Report</h2>
          </td>
          <td style="width: 30%; text-align: right; vertical-align: middle;">
            <t t-if="company.favicon">
              <img t-att-src="'data:image/png;base64,%s' % company.favicon.decode('utf-8')" style="max-height: 60px;" />
            </t>
          </td>
        </tr>
      </table>

      <table style="width: 100%; margin-bottom: 10px;">
        <tr><td><strong>Project:</strong> <t t-esc="doc.project_id.name or ''"/></td></tr>
        <tr>
          <td>
            <strong>Tower:</strong> <t t-esc="doc.tower_id.name or ''"/> -
            <strong>Flat:</strong> <t t-esc="doc.name or ''"/>
          </td>
        </tr>
      </table>

      <t t-foreach="doc.flat_site_visit_ids" t-as="visit">
        <!-- <h3 style="color: #444;">Report Name: <t t-esc="visit.name"/></h3> -->

      <table style="width: 100%; margin-bottom: 20px;">
        <tr>
          <td style="background-color: #f7f7f7; padding: 10px; border-left: 5px solid #4CAF50;">
            <span style="font-size: 14px; font-weight: bold; color: #333;">Report Name: </span>
            <span style="font-size: 14px; color: #000;"><t t-esc="doc.name or ''"/></span>
          </td>
        </tr>
      </table>

        <t t-foreach="visit.sv_location_ids" t-as="loc">
          <t t-if="loc.svb_location_ids">
            <h4 style="margin-top: 15px; color: #2E7D32;">Location - <t t-esc="loc.name or ''"/></h4>

            <!-- <table style="width:100%; border-collapse: collapse;" border="1"> -->
            <table class="table table-sm" style="width: 100%; border-collapse: collapse; font-size: 12px;" border="1">

              <thead>
                <tr style="background-color:#eee;">
                  <th>Photo</th>
                  <th>Issue Category</th>
                  <th>Issue</th>
                  <th>Remarks</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                <t t-foreach="loc.svb_location_ids" t-as="obs">
                  <tr>
                    <!-- Photo -->
                    <td>
                      <t t-foreach="obs.observation_image_ids" t-as="img">
                        <t t-if="img.maker_uploaded_img">
                          <img t-att-src="'data:image/png;base64,%s' % img.maker_uploaded_img.decode('utf-8')" style="max-width:80px; max-height:80px;" /><br/>
                        </t>
                        <t t-if="img.checker_uploaded_img">
                          <img t-att-src="'data:image/png;base64,%s' % img.checker_uploaded_img.decode('utf-8')" style="max-width:80px; max-height:80px;" /><br/>
                        </t>
                      </t>
                    </td>

                    <!-- Issue Category + Impact -->
                    <td>
                      <div style="font-weight: bold;padding: 5px;text-align: center;"><t t-esc="obs.issue_category_id.name or ''"/></div>
                      <div>

                        <div style="margin-top: 5px; font-size: 10px;">
                          <div style="font-weight: bold; margin-bottom: 3px;">Impact</div>
                      
                        <table style="margin-top:5px;">
                          <tr>
                            <td><div t-att-style="'width: 20px; height: 6px; background-color: %s' % ('#FFCF00' if obs.impact == 'low' else '#D9D9D9')"></div></td>
                            <td><div t-att-style="'width: 20px; height: 6px; background-color: %s' % ('#FFAE00' if obs.impact == 'medium' else '#D9D9D9')"></div></td>
                            <td><div t-att-style="'width: 20px; height: 6px; background-color: %s' % ('#FF1D00' if obs.impact == 'high' else '#D9D9D9')"></div></td>
                          </tr>
                          <tr>
                            <td style="font-size: 8px;">Low</td>
                            <td style="font-size: 8px;">Medium</td>
                            <td style="font-size: 8px;">High</td>
                          </tr>
                        </table>
                      </div>
                      </div>
                    </td>
                    <!-- Issue -->
                    <!-- <td><t t-esc="obs.description or ''"/></td> -->
                      <td style="padding: 5px; width: 120px; word-wrap: break-word; white-space: normal; text-align: center; vertical-align: middle;">
                  <t t-esc="obs.description or ''"/>
                </td>
                    <!-- Remarks -->
                    <!-- <td><t t-esc="obs.remark or ''"/></td> -->
                        <td style="padding: 5px; text-align: center; vertical-align: middle;">
                    <t t-esc="obs.remark or ''"/>
                  </td>
                    <!-- Status -->
                  <td style="padding: 5px; font-size: 11px; text-align: center; vertical-align: middle;">

                      <t t-if="obs.state == 'completed'">
                        <span style="color:green;">Completed</span>
                      </t>
                      <t t-else="">
                        <span>Pending</span>
                      </t>
                    </td>
                  </tr>
                </t>
              </tbody>
            </table>
          </t>
        </t>
      </t>

    </main>
  </template>
</odoo>
